{
  "resourceType": "Library",
  "id": "qt-prolongation-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "qt-prolongation-lens"
    }
  ],
  "version": "0.0.1",
  "name": "QT prolongation lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para la prolongación del QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para o prolongamento do QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til QT-forlængelse"
          }
        ]
      }
    ]
  },
  "title": "qt-prolongation-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para la prolongación del QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para o prolongamento do QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til QT-forlængelse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2026-02-02T15:31:30.964Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that highlights QT prolongation risk information when patient is taking Citalopram and has low potassium levels",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que resalta información sobre el riesgo de prolongación del QT cuando el paciente toma Citalopram y tiene niveles bajos de potasio"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que destaca informações sobre o risco de prolongamento do QT quando o paciente toma Citalopram e tem níveis baixos de potássio"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der fremhæver information om QT-forlængelsesrisiko når patienten tager Citalopram og har lavt kaliumniveau"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Highlight QT prolongation risk information in a preprocessed ePI when patient takes Citalopram and has low potassium (K+ < 3.5 mmol/L).",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Resaltar información sobre el riesgo de prolongación del QT en una ePI preprocesada cuando el paciente toma Citalopram y tiene potasio bajo (K+ < 3.5 mmol/L)."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Destacar informações sobre o risco de prolongamento do QT em uma ePI pré-processada quando o paciente toma Citalopram e tem potássio baixo (K+ < 3.5 mmol/L)."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Fremhæv information om QT-forlængelsesrisiko i en forbehandlet ePI når patienten tager Citalopram og har lavt kalium (K+ < 3.5 mmol/L)."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for QT prolongation risk",
      "data": "bGV0IGh0bWxEYXRhID0gaHRtbDsKbGV0IGlwc0RhdGEgPSBpcHM7CmxldCBsYW5nID0gIiI7ICAvLyBEZWZhdWx0IGxhbmd1YWdlLCB3aWxsIGJlIHNldCBieSBlUEkKCmxldCBnZXRTcGVjaWZpY2F0aW9uID0gKCkgPT4gewogICAgcmV0dXJuICIxLjAuMCI7Cn07CgpsZXQgYW5ub3RhdGlvblByb2Nlc3MgPSAobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlKSA9PiB7CiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNoZWNrKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmluY2x1ZGVzKGNoZWNrKSkgewogICAgICAgICAgICBsZXQgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNoZWNrKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZWxlbWVudHNbaV0uY2xhc3NMaXN0LmFkZChlbmhhbmNlVGFnKTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzW2ldLmNsYXNzTGlzdC5hZGQoInF0LXByb2xvbmdhdGlvbi1sZW5zIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIikubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0uaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCk7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCB8fCByZXNwb25zZSA9PSAiIikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgIkFubm90YXRpb24gcHJvY2Nlc3MgZmFpbGVkOiBSZXR1cm5lZCBlbXB0eSBvciBudWxsIHJlc3BvbnNlIgogICAgICAgICk7CiAgICAgICAgLy9yZXR1cm4gaHRtbERhdGEKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KfQoKCmxldCBhbm5vdGF0ZUhUTUxzZWN0aW9uID0gYXN5bmMgKGxpc3RPZkNhdGVnb3JpZXMsIGVuaGFuY2VUYWcpID0+IHsKICAgIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogICAgbGV0IGRvY3VtZW50OwoKICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIikgewogICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgICAgICBsZXQgeyBKU0RPTSB9ID0ganNkb207CiAgICAgICAgbGV0IGRvbSA9IG5ldyBKU0RPTShodG1sRGF0YSk7CiAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgICAgIHJldHVybiBhbm5vdGF0aW9uUHJvY2VzcyhsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgICAgICByZXR1cm4gYW5ub3RhdGlvblByb2Nlc3MobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlKTsKICAgIH0KfTsKCgoKbGV0IGVuaGFuY2UgPSBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWlwc0RhdGEgfHwgIWlwc0RhdGEuZW50cnkgfHwgaXBzRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklQUyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQoKICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgICBlcGk/LmVudHJ5Py5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsKICAgICAgICAgICAgbGFuZyA9IHJlcy5sYW5ndWFnZTsKICAgICAgICAgICAgY29uc29sZS5sb2coIjwNIERldGVjdGVkIGZyb20gQ29tcG9zaXRpb24ubGFuZ3VhZ2U6IiwgbGFuZyk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gMi4gSWYgbm90IGZvdW5kLCBjaGVjayBCdW5kbGUubGFuZ3VhZ2UKICAgIGlmICghbGFuZyAmJiBlcGk/Lmxhbmd1YWdlKSB7CiAgICAgICAgbGFuZyA9IGVwaS5sYW5ndWFnZTsKICAgICAgICBjb25zb2xlLmxvZygiPA0gRGV0ZWN0ZWQgZnJvbSBCdW5kbGUubGFuZ3VhZ2U6IiwgbGFuZyk7CiAgICB9CgogICAgLy8gMy4gRmFsbGJhY2sKICAgIGlmICghbGFuZykgewogICAgICAgIGNvbnNvbGUud2FybigioA8gTm8gbGFuZ3VhZ2UgZGV0ZWN0ZWQgaW4gQ29tcG9zaXRpb24gb3IgQnVuZGxlLiIpOwogICAgICAgIGxhbmcgPSAiZW4iOwogICAgfQoKICAgIGxldCBlbmhhbmNlVGFnID0gImhpZ2hsaWdodCI7CiAgICBsZXQgbGlzdE9mQ2F0ZWdvcmllc1RvU2VhcmNoID0gW3sgImNvZGUiOiAiZ3Jhdi0xIiwgInN5c3RlbSI6ICJodHRwOi8vZ3Jhdml0YXRlLWhlYWx0aC5ldS9jb2RlcyIgfV07IC8vd2hhdCB0byBsb29rIGluIGV4dGVuc2lvbnMgLW1hZGUgdXAgY29kZSBiZWNhdXNlIHRoZXJlIGlzIG5vbmUKCiAgICAvLyBIaWdobGlnaHQgPFFUIHByb2xvbmdhdGlvbiByaXNrPiBJRiBNZWRpY2F0aW9uUmVxdWVzdC5tZWRpY2F0aW9uID09IFtDaXRhbG9wcmFtXSAKICAgIC8vIEFORCBPYnNlcnZhdGlvbi5jb2RlID09ICJLKyIgKGxvaW5jIDI4MjMtMykgQU5EIE9ic2VydmF0aW9uLnZhbHVlIDwgMy41IG1tb2wvTAoKICAgIGNvbnN0IHBvdGFzc2l1bUNvZGVzID0gWyIyODIzLTMiLCAiNjI5OC00Il07IC8vIHdoYXQgdG8gbG9vayBpbiBJUFMgTGFiCiAgICBjb25zdCBjaXRhbG9wcmFtS2V5d29yZHMgPSBbImNpdGFsb3ByYW0iLCAiQ2l0YWxvcHJhbSJdOyAvLyB3aGF0IHRvIGxvb2sgaW4gbWVkaWNhdGlvbiByZXF1ZXN0IC8gc3RhdGVtZW50cwogICAgY29uc3QgY2l0YWxvcHJhbUNvZGVzID0gWyIyMDQ0NDciLCAiMzcyNzI5MDA5Il07Ly8gd2hhdCB0byBsb29rIGluIG1lZGljYXRpb24gcmVxdWVzdCAvIHN0YXRlbWVudHMKCiAgICBsZXQgaGFzTG93UG90YXNzaXVtID0gZmFsc2U7CiAgICBsZXQgdGFraW5nQ2l0YWxvcHJhbSA9IGZhbHNlOwoKICAgIC8vIEluZGV4IG1lZGljYXRpb25zIGJ5IHJlZmVyZW5jZSBJRAogICAgY29uc3QgbWVkaWNhdGlvbnNCeUlkID0gbmV3IE1hcCgpOwogICAgaXBzRGF0YS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGlmIChlbnRyeS5yZXNvdXJjZT8ucmVzb3VyY2VUeXBlID09PSAiTWVkaWNhdGlvbiIgJiYgZW50cnkucmVzb3VyY2UuaWQpIHsKICAgICAgICAgICAgbWVkaWNhdGlvbnNCeUlkLnNldChgTWVkaWNhdGlvbi8ke2VudHJ5LnJlc291cmNlLmlkfWAsIGVudHJ5LnJlc291cmNlKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGlwc0RhdGEuZW50cnkpIHsKICAgICAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsKICAgICAgICBpZiAoIXJlcykgY29udGludWU7CgogICAgICAgIC8vIENoZWNrIHBvdGFzc2l1bQogICAgICAgIGlmICgKICAgICAgICAgICAgcmVzLnJlc291cmNlVHlwZSA9PT0gIk9ic2VydmF0aW9uIiAmJgogICAgICAgICAgICByZXMuY29kZT8uY29kaW5nICYmCiAgICAgICAgICAgIHR5cGVvZiByZXMudmFsdWVRdWFudGl0eT8udmFsdWUgPT09ICJudW1iZXIiCiAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnN0IGlzSyA9IHJlcy5jb2RlLmNvZGluZy5zb21lKAogICAgICAgICAgICAgICAgKGMpID0+CiAgICAgICAgICAgICAgICAgICAgcG90YXNzaXVtQ29kZXMuaW5jbHVkZXMoYy5jb2RlKSB8fAogICAgICAgICAgICAgICAgICAgIGMuZGlzcGxheT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygicG90YXNzaXVtIikKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKGlzSyAmJiByZXMudmFsdWVRdWFudGl0eS52YWx1ZSA8IDMuNSkgewogICAgICAgICAgICAgICAgaGFzTG93UG90YXNzaXVtID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCKgDyBMb3cgSys6IiwgcmVzLnZhbHVlUXVhbnRpdHkudmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBNZWRpY2F0aW9uU3RhdGVtZW50IG9yIE1lZGljYXRpb25SZXF1ZXN0CiAgICAgICAgaWYgKFsiTWVkaWNhdGlvblN0YXRlbWVudCIsICJNZWRpY2F0aW9uUmVxdWVzdCJdLmluY2x1ZGVzKHJlcy5yZXNvdXJjZVR5cGUpKSB7CiAgICAgICAgICAgIGxldCBjb2RlcyA9IFtdOwoKICAgICAgICAgICAgLy8gQ2FzZSAxOiBtZWRpY2F0aW9uQ29kZWFibGVDb25jZXB0CiAgICAgICAgICAgIGlmIChyZXMubWVkaWNhdGlvbkNvZGVhYmxlQ29uY2VwdD8uY29kaW5nKSB7CiAgICAgICAgICAgICAgICBjb2RlcyA9IHJlcy5tZWRpY2F0aW9uQ29kZWFibGVDb25jZXB0LmNvZGluZzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2FzZSAyOiBtZWRpY2F0aW9uUmVmZXJlbmNlIHRvIE1lZGljYXRpb24gcmVzb3VyY2UKICAgICAgICAgICAgaWYgKHJlcy5tZWRpY2F0aW9uUmVmZXJlbmNlPy5yZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZFJlZiA9IHJlcy5tZWRpY2F0aW9uUmVmZXJlbmNlLnJlZmVyZW5jZTsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZCA9IG1lZGljYXRpb25zQnlJZC5nZXQobWVkUmVmKTsKICAgICAgICAgICAgICAgIGlmIChtZWQ/LmNvZGU/LmNvZGluZykgewogICAgICAgICAgICAgICAgICAgIGNvZGVzID0gY29kZXMuY29uY2F0KG1lZC5jb2RlLmNvZGluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV2YWx1YXRlIGFsbCBmb3VuZCBjb2RlcwogICAgICAgICAgICBmb3IgKGNvbnN0IGNvZGluZyBvZiBjb2RlcykgewogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hCeUNvZGUgPSBjaXRhbG9wcmFtQ29kZXMuaW5jbHVkZXMoY29kaW5nLmNvZGUpOwogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hCeVRleHQgPSBjaXRhbG9wcmFtS2V5d29yZHMuc29tZSgoa3cpID0+CiAgICAgICAgICAgICAgICAgICAgKGNvZGluZy5kaXNwbGF5IHx8ICIiKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGt3KQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAobWF0Y2hCeUNvZGUgfHwgbWF0Y2hCeVRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0YWtpbmdDaXRhbG9wcmFtID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiPYogQ2l0YWxvcHJhbSBtYXRjaGVkIHZpYSBjb2RlIG9yIGRpc3BsYXk6IiwgY29kaW5nLmNvZGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBlUEkgdHJhc2xhdGlvbiBmcm9tIHRlcm1pbm9sb2d5IGNvZGVzIHRvIHRoZWlyIGh1bWFuIHJlZGFibGUgdHJhbnNsYXRpb25zIGluIHRoZSBzZWN0aW9ucwogICAgbGV0IGNvbXBvc2l0aW9ucyA9IDA7CiAgICBsZXQgY2F0ZWdvcmllcyA9IFtdOwogICAgZXBpLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgaWYgKGVudHJ5LnJlc291cmNlLnJlc291cmNlVHlwZSA9PSAiQ29tcG9zaXRpb24iKSB7CiAgICAgICAgICAgIGNvbXBvc2l0aW9ucysrOwogICAgICAgICAgICAvL0l0ZXJhdGVkIHRocm91Z2ggdGhlIENvbmRpdGlvbiBlbGVtZW50IHNlYXJjaGluZyBmb3IgY29uZGl0aW9ucwogICAgICAgICAgICBlbnRyeS5yZXNvdXJjZS5leHRlbnNpb24uZm9yRWFjaCgoZWxlbWVudCkgPT4gewoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBwb3NpdGlvbiBvZiB0aGUgZXh0ZW5zaW9uWzFdIGlzIGNvcnJlY3QKICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS51cmwgPT0gImNvbmNlcHQiKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2VhcmNoIHRocm91Z2ggdGhlIGRpZmZlcmVudCB0ZXJtaW5vbG9naWVzIHRoYXQgbWF5IGJlIGF2YWlibGUgdG8gY2hlY2sgaW4gdGhlIGNvbmRpdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdC5jb2RpbmcuZm9yRWFjaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb2RpbmcpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uOiAiICsgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcgKyAiOiIgKyBjb2RpbmcuY29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzIHRvIHNlYXJjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2guc29tZShpdGVtID0+IGl0ZW0uY29kZSA9PT0gY29kaW5nLmNvZGUgJiYgaXRlbS5zeXN0ZW0gPT09IGNvZGluZy5zeXN0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBpcyBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKICAgIGlmIChjb21wb3NpdGlvbnMgPT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGVQSTogbm8gY2F0ZWdvcnkgIkNvbXBvc2l0aW9uIiBmb3VuZCcpOwogICAgfQoKICAgIGlmIChjYXRlZ29yaWVzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCJObyBjYXRlZ29yaWVzIGZvdW5kIiwgY2F0ZWdvcmllcyk7CiAgICAgICAgcmV0dXJuIGh0bWxEYXRhOwogICAgfQogICAgaWYgKGhhc0xvd1BvdGFzc2l1bSAmJiB0YWtpbmdDaXRhbG9wcmFtKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IGFubm90YXRlSFRNTHNlY3Rpb24oY2F0ZWdvcmllcywgZW5oYW5jZVRhZyk7CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgY29uc29sZS53YXJuKCJObyBRVCBwcm9sb25nYXRpb24gcmlzayBjb25kaXRpb24gbWV0LiIpOwogICAgICAgIHJldHVybiBodG1sRGF0YTsKICAgIH0KCn07CgoKZnVuY3Rpb24gZ2V0UmVwb3J0KGxhbmcgPSAiZW4iKSB7CiAgICBjb25zb2xlLmxvZygiR2VuZXJhdGluZyByZXBvcnQgaW4gbGFuZ3VhZ2U6IiwgbGFuZyk7CiAgICByZXR1cm4geyBtZXNzYWdlOiBnZXRFeHBsYW5hdGlvbihsYW5nKSwgc3RhdHVzOiAiIiB9OwoKCn0KCi8vIC0tLSBHZXQgdXNlci1mYWNpbmcgcmVwb3J0IHNlbnRlbmNlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSAtLS0KZnVuY3Rpb24gZ2V0RXhwbGFuYXRpb24obGFuZyA9ICJlbiIpIHsKICAgIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIGV4cGxhbmF0aW9uIGluIGxhbmd1YWdlOiIsIGxhbmcpOwogICAgcmV0dXJuICIiOwp9CgovLyAtLS0gRXhwb3J0ZWQgQVBJIC0tLQpyZXR1cm4gewogICAgZW5oYW5jZTogZW5oYW5jZSwKICAgIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCiAgICBleHBsYW5hdGlvbjogKGxhbmd1YWdlKSA9PiBnZXRFeHBsYW5hdGlvbihsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAogICAgcmVwb3J0OiAobGFuZ3VhZ2UpID0+IGdldFJlcG9ydChsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAp9Owo=",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para el riesgo de prolongación del QT"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para o risco de prolongamento do QT"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til QT-forlængelsesrisiko"
              }
            ]
          }
        ]
      }
    }
  ]
}